<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Banner Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet"> 
    <style>
        :root {
            --primary-color: #765cab;
            --secondary-color: #2e2742;
            --background-color: #1f2939;
            --text-color: #d9dfe7;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .header {
            background-color: #05001a;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.2em;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            flex-direction: column; 
        }

        .toolbar {
            background-color: #171f2b;
            padding: 10px;
            display: flex;
            flex-wrap: wrap; 
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            align-items: center;
            overflow-x: auto; 
        }

        .toolbar button, 
        .toolbar .control-group, 
        .toolbar .color-picker,
        .toolbar .export-dropdown,
        .toolbar .shape-dropdown {
            margin-bottom: 10px;
        }

        .toolbar button,
        .toolbar select, 
        .toolbar input[type="color"] {
            background-color: var(--primary-color);
            border: none;
            color: white;
            padding: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
            flex: 1 1 auto;
            min-width: 80px;
        }

        .toolbar button:hover,
        .toolbar select:hover,
        .toolbar input[type="color"]:hover {
            background-color: var(--secondary-color);
        }

        .toolbar .dropdown-content { 
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .toolbar .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .toolbar .dropdown-content a:hover { 
            background-color: #f1f1f1
        }

        .toolbar .export-dropdown:hover .dropdown-content,
        .toolbar .shape-dropdown:hover .dropdown-content { 
            display: block;
        }

        #canvas-container {
            flex: 1;
            overflow: auto;
            padding: 10px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #canvas {
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .layers {
            background-color: #171f2b;
            padding: 10px;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            max-height: 200px; 
        }

        .layer-item {
            padding: 8px;
            margin: 5px 0;
            color: black;
            background-color: #e4e3ec;
            cursor: move; 
            border-radius: 4px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .layer-item.active {
            background-color: #b4bcfa;
        }

        .layer-item .move-layer {
            cursor: grab;
            margin-left: 10px;
            display: flex;
            align-items: center;
        }

        .layer-item button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px;
            margin-left: 5px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px; 
        }

        input[type="number"] {
            width: 50px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed; 
            z-index: 1; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0, 0, 0, 0.4); 
        }

        .modal-content {
            background-color: #fefefe;
            color: #171f2b;
            margin: 15% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 30%; 
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #image-upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            display: none;
        }

        #image-upload-overlay input[type="file"] {
            display: block;
        }
        #canvas-container {
            flex: 1;
            overflow: hidden; /* Change from 'auto' to 'hidden' */
            padding: 10px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Tablet Layout (>= 768px) */
        @media (min-width: 768px) {
            .toolbar {
                flex-wrap: nowrap;
            }

            .toolbar button {
                flex: 0 0 auto; 
            }
        }

        /* Desktop Layout (>= 1024px) */
        @media (min-width: 1024px) {
            .container {
                flex-direction: row; 
            }

            .toolbar {
                flex-direction: column;
                width: 250px;
                height: calc(100vh - 50px);
                overflow-y: auto;
                overflow-x: hidden;
            }

            .layers {
                width: 250px;
                order: 2; 
                max-height: none;
                height: calc(100vh - 50px); 
            }

            #canvas-container {
                flex-grow: 1;
                margin: 0 10px;
            }
        }


        /* Large Desktop Layout (>= 1440px) */
        @media (min-width: 1440px) {
            .toolbar,
            .layers {
                width: 300px; 
            }

            #canvas-container {
                margin: 0 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        Advanced Banner Editor
    </div>
    <div class="container">
        <div class="toolbar">
            <div class="shape-dropdown">
                <button><i class="fas fa-shapes"></i> Add Shape</button>
                <div class="dropdown-content">
                    <a href="#" onclick="addRect()">Rectangle</a>
                    <a href="#" onclick="addCircle()">Circle</a>
                    <a href="#" onclick="addTriangle()">Triangle</a>
                </div>
            </div>
            <button onclick="addText()"><i class="fas fa-font"></i> Text</button>
            <button onclick="addImage()"><i class="fas fa-image"></i> Image</button> 
            <button onclick="deleteSelected()"><i class="fas fa-trash"></i> Delete</button>

            <div class="export-dropdown">
                <button><i class="fas fa-file-export"></i> Export</button>
                <div class="dropdown-content">
                    <a href="#" onclick="exportToJson()">Export JSON</a>
                    <a href="#" onclick="exportToPNG()">Export PNG</a>
                    <a href="#" onclick="exportToJPEG()">Export JPEG</a>
                </div>
            </div>

            <div class="control-group">
                <label for="fontFamily">Font Family:</label>
                <select id="fontFamily" onchange="changeFontFamily()">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Roboto">Roboto</option>
                    <option value="Open Sans">Open Sans</option>
                    <option value="Lato">Lato</option>
                    </select>
            </div>
            <div class="control-group">
                <label for="fontSize">Font Size:</label>
                <input type="number" id="fontSize" value="20" min="1" max="100" onchange="changeFontSize()">
            </div>
            <div class="control-group">
                <label for="opacity">Opacity:</label>
                <input type="number" id="opacity" value="100" min="0" max="100" onchange="changeOpacity()">
            </div>
            <div class="control-group">
                <label for="fillColor">Fill Color:</label>
                <input type="color" id="fillColor" value="#ff0000" onchange="changeColor()">
            </div>
            <button onclick="openCanvasSizeModal()">Set Canvas Size</button>
            <button onclick="openBackgroundModal()">Set Background</button>
        </div>

        <div id="canvas-container">
            <canvas id="canvas"></canvas>
            <div id="image-upload-overlay">
                <input type="file" id="image-upload" accept="image/*" style="display: none;">
            </div>
            <div id="background-image-upload-overlay">
                <input type="file" id="background-image-upload" accept="image/*" style="display: none;">
            </div> 
        </div>
        <div class="layers" id="layers-panel">
            <h3>Layers</h3>
            <div id="layers-list"></div>
        </div>
    </div>

    <!-- Canvas Size Modal -->
    <div id="canvasSizeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCanvasSizeModal()">×</span>
            <h2>Set Canvas Size</h2>
            <label for="canvasWidth">Width (px):</label>
            <input type="number" id="canvasWidth" value="800"><br><br>
            <label for="canvasHeight">Height (px):</label>
            <input type="number" id="canvasHeight" value="600"><br><br>
            <button onclick="setCanvasSize()">Set Size</button>
        </div>
    </div>

    <!-- Background Image Modal -->
    <div id="backgroundModal" class="modal"> 
        <div class="modal-content">
            <span class="close" onclick="closeBackgroundModal()">×</span>
            <h2>Set Background</h2>
            <label for="backgroundColor">Color:</label>
            <input type="color" id="backgroundColor" value="#ffffff" onchange="setBackgroundColor()"><br><br>
            <button onclick="openBackgroundImageUpload()">Upload Background Image</button>
        </div>
    </div>

    <script>
        // Add this at the beginning of the script
        // Copy the entire script section from your provided HTML
        // ... 

        const canvas = new fabric.Canvas('canvas', {
            width: 800, 
            height: 600  
        });
        let layerCount = 0;
        let copiedObject = null; 

        // window.onload = function() {
        //     const canvasData = localStorage.getItem('canvasData');
        //     if (canvasData) {
        //         const parsedData = JSON.parse(canvasData);
        //         canvas.loadFromJSON(parsedData, function() {
        //             canvas.renderAll();
        //             updateLayersList();
        //         });
        //         console.log(parsedData);
        //         const canvasResolution = localStorage.getItem('canvasResolution');
        //         console.log(canvasResolution);
        //         // parsed resolution is in widthxheight string so we need to split it and get the width and height
        //         const ResWidth = parseInt(canvasResolution.split('x')[0]);
        //         const ResHeight = parseInt(canvasResolution.split('x')[1]);
                
        //         console.log(ResWidth, ResHeight);
        //         canvas.setWidth(ResWidth);
        //         canvas.setHeight(ResHeight);
        //     }
        // };
 
        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            const canvasRatio = canvas.width / canvas.height;
            const containerRatio = containerWidth / containerHeight;

            let scale, newWidth, newHeight;

            if (canvasRatio > containerRatio) {
                // Canvas is wider than container
                scale = containerWidth / canvas.width;
                newWidth = containerWidth;
                newHeight = canvas.height * scale;
            } else {
                // Canvas is taller than container
                scale = containerHeight / canvas.height;
                newHeight = containerHeight;
                newWidth = canvas.width * scale;
            }

    canvas.setZoom(scale);
    canvas.setDimensions({width: newWidth, height: newHeight});
    canvas.renderAll();
}
        window.onload = function() {
        initializeCanvas();
        resizeCanvas();
    };

    function initializeCanvas() {
    const canvasData = localStorage.getItem('canvasData');
    const canvasResolution = localStorage.getItem('canvasResolution');

    if (canvasResolution) {
        const [ResWidth, ResHeight] = canvasResolution.split('x').map(Number);
        console.log(`Setting canvas size to: ${ResWidth}x${ResHeight}`);
        canvas.setWidth(ResWidth);
        canvas.setHeight(ResHeight);
    }

    if (canvasData) {
        const parsedData = JSON.parse(canvasData);
        console.log('Loading canvas data:', parsedData);
        
        // Check if there's a background image
        if (parsedData.backgroundImage) {
            fabric.Image.fromURL(parsedData.backgroundImage.src, function(img) {
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                    scaleX: canvas.width / img.width,
                    scaleY: canvas.height / img.height
                });
            });
            delete parsedData.backgroundImage; // Remove background image from objects
        }

        // Load other objects
        canvas.loadFromJSON(parsedData, function() {
            canvas.renderAll();
            updateLayersList();
        });
    }
} 
    
    // Add Shape Functions
        function addRect() {
            const rect = new fabric.Rect({
                left: 50,
                top: 50,
                fill: document.getElementById('fillColor').value,
                width: 50,
                height: 50
            });
            addToCanvas(rect, 'Rectangle');
        }

        function addCircle() {
            const circle = new fabric.Circle({
                left: 50,
                top: 50,
                fill: document.getElementById('fillColor').value,
                radius: 25
            });
            addToCanvas(circle, 'Circle');
        }

        function addTriangle() {
            const triangle = new fabric.Triangle({
                left: 50,
                top: 50,
                fill: document.getElementById('fillColor').value, 
                width: 50,
                height: 50
            });
            addToCanvas(triangle, 'Triangle');
        }

        function addText() {
            const text = new fabric.IText('Edit me', {
                left: 50,
                top: 50,
                fill: document.getElementById('fillColor').value, 
                fontSize: parseInt(document.getElementById('fontSize').value),
                fontFamily: document.getElementById('fontFamily').value 
            });
            addToCanvas(text, 'Text');
        }

        function addImage() {
            document.getElementById('image-upload').click();
        }

        document.getElementById('image-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                fabric.Image.fromURL(event.target.result, function(img) {
                    img.scaleToWidth(200); 
                    addToCanvas(img, 'Image');
                    document.getElementById('image-upload-overlay').style.display = 'none';
                });
            };
            reader.readAsDataURL(file);
            document.getElementById('image-upload-overlay').style.display = 'block'; 
        });

        function addToCanvas(object, type) {
            canvas.add(object);
            updateLayersList();
            canvas.setActiveObject(object);
            canvas.renderAll();
        }

        function deleteSelected() {
            const activeObjects = canvas.getActiveObjects();
            if (activeObjects.length > 0) {
                activeObjects.forEach(object => {
                    canvas.remove(object);
                });
                canvas.discardActiveObject(); 
                canvas.renderAll();
                updateLayersList();
            }
        }

        // Add event listeners to update layers when objects are added or removed
        canvas.on('object:added', updateLayersList);
        canvas.on('object:removed', updateLayersList);

        function changeFontFamily() {
            const activeObject = canvas.getActiveObject();
            if (activeObject && activeObject.type === 'i-text') {
                activeObject.set('fontFamily', document.getElementById('fontFamily').value);
                canvas.renderAll();
            }
        }

        function changeFontSize() {
            const activeObject = canvas.getActiveObject();
            const fontSize = parseInt(document.getElementById('fontSize').value);
            if (activeObject && activeObject.type === 'i-text') {
                activeObject.set('fontSize', fontSize);
                canvas.renderAll();
            }
        }

        function changeColor() {
            const activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.set('fill', document.getElementById('fillColor').value);
                canvas.renderAll();
            }
        }

        function changeOpacity() {
            const activeObject = canvas.getActiveObject();
            const opacity = parseInt(document.getElementById('opacity').value) / 100;
            if (activeObject) {
                activeObject.set('opacity', opacity);
                canvas.renderAll();
            }
        }

        function addLayer(object, type) {
            layerCount++;
            const layerItem = document.createElement('div');
            layerItem.className = 'layer-item';
            layerItem.textContent = `${type} ${layerCount}`;
            layerItem.onclick = () => selectObject(object);

            const moveUpButton = document.createElement('button');
            moveUpButton.innerHTML = '<i class="fas fa-arrow-up"></i>';
            moveUpButton.addEventListener('click', (e) => {
                e.stopPropagation(); 
                moveLayerUp(object);
            });

            const moveDownButton = document.createElement('button');
            moveDownButton.innerHTML = '<i class="fas fa-arrow-down"></i>';
            moveDownButton.addEventListener('click', (e) => {
                e.stopPropagation();
                moveLayerDown(object);
            });

            const moveLayerDiv = document.createElement('div'); 
            moveLayerDiv.className = 'move-layer';
            moveLayerDiv.appendChild(moveUpButton);
            moveLayerDiv.appendChild(moveDownButton);
            layerItem.appendChild(moveLayerDiv);

            object.layerItem = layerItem;
            document.getElementById('layers-list').appendChild(layerItem);
        }

        function removeLayer(object) {
            if (object.layerItem) {
                object.layerItem.remove();
            }
        }

        function selectObject(object) {
            canvas.setActiveObject(object);
            canvas.renderAll();
            updateLayerSelection();
        }

        function updateLayerSelection() {
            const activeObject = canvas.getActiveObject();
            document.querySelectorAll('.layer-item').forEach(item => {
                item.classList.remove('active');
            });
            if (activeObject && activeObject.layerItem) {
                activeObject.layerItem.classList.add('active');
            }
        }

        canvas.on('selection:created', updateLayerSelection);
        canvas.on('selection:updated', updateLayerSelection);
        canvas.on('selection:cleared', updateLayerSelection);

        // function resizeCanvas() {
        //     const container = document.getElementById('canvas-container');
        //     const ratio = canvas.width / canvas.height; 
        //     let newWidth = container.clientWidth - 20; 
        //     let newHeight = newWidth / ratio;

        //     if (newHeight > container.clientHeight - 20) {
        //         newHeight = container.clientHeight - 20;
        //         newWidth = newHeight * ratio;
        //     }

        //     canvas.setDimensions({
        //         width: newWidth,
        //         height: newHeight
        //     });
        //     canvas.renderAll();
        // }

        function moveLayerUp(object) {
            const currentIndex = canvas.getObjects().indexOf(object);
            if (currentIndex > 0) {
                moveLayer(currentIndex, currentIndex - 1);
            }
        }

        function moveLayerDown(object) {
            const currentIndex = canvas.getObjects().indexOf(object);
            if (currentIndex < canvas.getObjects().length - 1) {
                moveLayer(currentIndex, currentIndex + 1);
            }
        }

        function moveLayer(fromIndex, toIndex) {
            const objectToMove = canvas.item(fromIndex);
            canvas.moveTo(objectToMove, toIndex);

            const layersList = document.getElementById('layers-list');
            const layerToMove = layersList.children[fromIndex];
            layersList.removeChild(layerToMove);
            if (toIndex >= layersList.children.length) {
                layersList.appendChild(layerToMove);
            } else {
                layersList.insertBefore(layerToMove, layersList.children[toIndex]);
            }
        }

        function exportToJson() {
            const json = canvas.toJSON();
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(json));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "canvas_data.json");
            document.body.appendChild(downloadAnchorNode); 
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function exportToPNG() {
            const dataURL = canvas.toDataURL({ format: 'png' });
            downloadImage(dataURL, 'canvas.png');
        }

        function exportToJPEG() {
            const dataURL = canvas.toDataURL({ format: 'jpeg', quality: 0.8 }); 
            downloadImage(dataURL, 'canvas.jpg');
        }

        function downloadImage(dataURL, filename) {
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas(); 

        document.addEventListener('keydown', function(e) {
            const NUDGE_AMOUNT = 1; 
            const activeObject = canvas.getActiveObject();

            if (activeObject) {
                switch (e.key) {
                    case 'ArrowUp':
                        e.preventDefault();
                        activeObject.top -= NUDGE_AMOUNT;
                        canvas.renderAll();
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        activeObject.top += NUDGE_AMOUNT;
                        canvas.renderAll();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        activeObject.left -= NUDGE_AMOUNT;
                        canvas.renderAll();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        activeObject.left += NUDGE_AMOUNT;
                        canvas.renderAll();
                        break;
                    case 'Delete':
                        deleteSelected();
                        break;
                }
            }

            // Copy
            if ((e.ctrlKey || e.metaKey) && e.key === 'c' && activeObject) {
                e.preventDefault();
                copiedObject = activeObject.clone(); 
            }

            // Paste
            if ((e.ctrlKey || e.metaKey) && e.key === 'v' && copiedObject) {
                e.preventDefault();
                const clonedObject = copiedObject.clone(); 
                canvas.add(clonedObject);
                canvas.setActiveObject(clonedObject);
                canvas.renderAll();
            }
        });

        // Canvas Size Modal
        const canvasSizeModal = document.getElementById("canvasSizeModal");

        function openCanvasSizeModal() {
            canvasSizeModal.style.display = "block";
        }

        function closeCanvasSizeModal() {
            canvasSizeModal.style.display = "none";
        }

        function setCanvasSize() {
            const width = parseInt(document.getElementById("canvasWidth").value);
            const height = parseInt(document.getElementById("canvasHeight").value);
            canvas.setWidth(width);
            canvas.setHeight(height);
            resizeCanvas(); 
            closeCanvasSizeModal();
        }

        // Background Modal
        const backgroundModal = document.getElementById("backgroundModal"); 

        function openBackgroundModal() {
            backgroundModal.style.display = "block";
        }

        function closeBackgroundModal() {
            backgroundModal.style.display = "none";
        }

        function setBackgroundColor() {
            canvas.backgroundColor = document.getElementById('backgroundColor').value;
            canvas.renderAll();
            closeBackgroundModal(); 
        }

        // Function to trigger the file input click
        function openBackgroundImageUpload() {
            document.getElementById('background-image-upload').click();
        }

        // Handle background image upload
        document.getElementById('background-image-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                fabric.Image.fromURL(event.target.result, function(img) {
                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                        scaleX: canvas.width / img.width,
                        scaleY: canvas.height / img.height
                    });
                    document.getElementById('background-image-upload-overlay').style.display = 'none'; 
                });
            };

            reader.readAsDataURL(file);
            document.getElementById('background-image-upload-overlay').style.display = 'block'; 
            closeBackgroundModal(); 
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target === canvasSizeModal) {
                closeCanvasSizeModal();
            }
            if (event.target === backgroundModal) {
                closeBackgroundModal();
            }
        }


        // Add this function to update the layers list
        function updateLayersList() {
            const layersList = document.getElementById('layers-list');
            layersList.innerHTML = '';
            canvas.getObjects().forEach((obj, index) => {
                addLayer(obj, obj.type || 'Object', index);
            });
        }

        // Modify the addLayer function to include the layer number
        function addLayer(object, type, index) {
            const layerItem = document.createElement('div');
            layerItem.className = 'layer-item';
            layerItem.textContent = `${type} ${index + 1}`;
            layerItem.onclick = () => selectObject(object);

            const moveUpButton = document.createElement('button');
            moveUpButton.innerHTML = '<i class="fas fa-arrow-up"></i>';
            moveUpButton.addEventListener('click', (e) => {
                e.stopPropagation(); 
                moveLayerUp(object);
            });

            const moveDownButton = document.createElement('button');
            moveDownButton.innerHTML = '<i class="fas fa-arrow-down"></i>';
            moveDownButton.addEventListener('click', (e) => {
                e.stopPropagation();
                moveLayerDown(object);
            });

            const moveLayerDiv = document.createElement('div'); 
            moveLayerDiv.className = 'move-layer';
            moveLayerDiv.appendChild(moveUpButton);
            moveLayerDiv.appendChild(moveDownButton);
            layerItem.appendChild(moveLayerDiv);

            object.layerItem = layerItem;
            document.getElementById('layers-list').appendChild(layerItem);
        }

        // Add a function to save the edited banner
        function saveBanner() {
            const canvasJSON = JSON.stringify(canvas.toJSON());
            localStorage.setItem('editedCanvasData', canvasJSON);
            // window.close();
            //go to home route
            window.location.href = '/';
        }

        // Add a save button to the toolbar
        const saveButton = document.createElement('button');
        saveButton.innerHTML = '<i class="fas fa-save"></i> Save';
        saveButton.onclick = saveBanner;
        document.querySelector('.toolbar').appendChild(saveButton);
    </script>
</body>
</html>
